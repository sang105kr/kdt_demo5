<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragment/layout::main(
        ~{::title},
        ~{::link},
        ~{::script},
        ~{::style},
        ~{::top},
        ~{::banner},
        ~{::gnb},
        ~{::main},
        ~{::footer}
      )}">
<head>
  <title th:fragment="title">게시글 목록</title>
  <link rel="stylesheet" href="/css/board/list.css" th:fragment="link">
  <script defer src="/js/board/list.js" th:fragment="script"></script>
  <style th:fragment="style"></style>
</head>
<body>
  <th:block th:fragment="top">
    <nav class="topmenu" th:insert="~{fragment/top::topmenu}"/>
  </th:block>
  <th:block th:fragment="banner">
    <header class="head" th:insert="~{fragment/banner::global}"/>
  </th:block>
  <th:block th:fragment="gnb">
    <nav class="gnb" th:insert="~{fragment/menu::gnbmenu}"/>
  </th:block>
  <th:block th:fragment="main">
    <main class="main">
      <!-- 동적 제목 표시 -->
      <h3 style="text-align:center;font-size:2rem;font-weight:700;margin-bottom:28px;letter-spacing:-1px;">
        <span th:if="${categoryName != null}" th:text="${categoryName + ' 게시글 목록'}">카테고리 게시글 목록</span>
        <span th:if="${categoryName == null}" th:text="'전체 게시글 목록'">전체 게시글 목록</span>
      </h3>
      <div th:if="${msg}" class="global-err" th:text="${msg}"></div>
      
      <!-- 검색 결과 표시 -->
      <div th:if="${searchKeyword != null and !#strings.isEmpty(searchKeyword)}" class="search-result-info">
        <span th:text="'검색어: ' + ${searchKeyword} + '에 대한 ' + ${pagination.totalCount} + '개의 결과'"></span>
        <a th:href="@{/board(category=${selectedCategory})}" class="clear-search">검색 초기화</a>
      </div>
      <!-- 검색 영역 -->
      <div class="search-area-row">
        <div class="search-area">
          <form th:action="@{/board}" method="get" class="search-form">
            <input type="hidden" name="category" th:value="${selectedCategory}">
            <input type="text" name="search" th:value="${searchKeyword}" placeholder="제목으로 검색..." class="search-input">
            <button type="submit" class="btn btn--outline btn--small">검색</button>
          </form>
        </div>
      </div>
      <table class="board-table" th:classappend="${categoryName == null ? 'has-category' : ''}">
        <thead>
        <tr>
          <th>번호</th>
          <!-- 전체 목록일 때만 카테고리 컬럼 표시 -->
          <th th:if="${categoryName == null}">카테고리</th>
          <th style="min-width: 500px;">제목</th>
          <th>작성자</th>
          <th>조회수</th>
          <th>작성일</th>
          <th><i class="fas fa-thumbs-up" style="color: #28a745;"></i></th>
          <th><i class="fas fa-thumbs-down" style="color: #dc3545;"></i></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="board : ${list}" th:attr="data-board-id=${board.boardId}">
          <td class="number-cell" th:text="${board.boardId}">1</td>
          <!-- 전체 목록일 때만 카테고리 컬럼 표시 -->
          <td th:if="${categoryName == null}" class="category-cell" th:text="${categoryNameMap.get(board.boardId)}">카테고리</td>
          <td class="title-cell">
            <!-- 계층형 들여쓰기 -->
            <span th:if="${board.bindent > 0}" class="indent" th:style="'margin-left:' + (${board.bindent} * 16) + 'px'">
              <i class="fas fa-reply fa-xs" style="margin-right:2px;"></i>
            </span>
            <a th:href="@{/board/{id}(id=${board.boardId})}" th:text="${board.title}">제목</a>
          </td>
          <td class="center-cell" th:text="${board.nickname}">작성자</td>
          <td class="number-cell" th:text="${board.hit}">0</td>
          <td class="center-cell" th:text="${#temporals.format(board.cdate,'yy/MM/dd')}">2024/01/01</td>
          <td class="number-cell" th:text="${likeDislikeMap.get(board.boardId)?.get('like') ?: 0}">0</td>
          <td class="number-cell" th:text="${likeDislikeMap.get(board.boardId)?.get('dislike') ?: 0}">0</td>
        </tr>
        </tbody>
      </table>
      
      <!-- 글쓰기 버튼 -->
      <div class="btn-area">
        <a href="/board/add" class="btn btn--primary btn--medium">글쓰기</a>
      </div>
      
      <!-- 페이지네이션 -->
      <div class="pagination" th:if="${pagination != null}">
        <!-- 처음(<<) -->
        <a th:if="${pagination.startPage > 1}"
           th:href="@{/board(category=${selectedCategory}, search=${searchKeyword}, pageNo=1)}"
           class="btn btn--outline btn--medium pagination-btn">
           <i class="fas fa-angle-double-left"></i>
        </a>
        <!-- 이전블록(≪) -->
        <a th:if="${pagination.hasPrevBlock}"
           th:href="@{/board(category=${selectedCategory}, search=${searchKeyword}, pageNo=${pagination.startPage - 1})}"
           class="btn btn--outline btn--medium pagination-btn">
           <i class="fas fa-angle-left"></i>
        </a>
        <!-- 페이지 번호들 -->
        <span th:each="pageNum : ${#numbers.sequence(pagination.startPage, pagination.endPage)}">
          <a th:if="${pageNum != pagination.pageNo}"
             th:href="@{/board(category=${selectedCategory}, search=${searchKeyword}, pageNo=${pageNum})}"
             class="btn btn--outline btn--medium pagination-btn"
             th:text="${pageNum}">1</a>
          <span th:if="${pageNum == pagination.pageNo}"
                class="btn btn--primary btn--medium pagination-btn"
                th:text="${pageNum}">1</span>
        </span>
        <!-- 다음블록(≫) -->
        <a th:if="${pagination.hasNextBlock}"
           th:href="@{/board(category=${selectedCategory}, search=${searchKeyword}, pageNo=${pagination.endPage + 1})}"
           class="btn btn--outline btn--medium pagination-btn">
           <i class="fas fa-angle-right"></i>
        </a>
        <!-- 끝(>>) -->
        <a th:if="${pagination.endPage < pagination.totalPages}"
           th:href="@{/board(category=${selectedCategory}, search=${searchKeyword}, pageNo=${pagination.totalPages})}"
           class="btn btn--outline btn--medium pagination-btn">
           <i class="fas fa-angle-double-right"></i>
        </a>
      </div>

      <!-- 권한에 따른 조건부 렌더링 예시 -->
      <div class="board-actions" th:if="${isAdmin}">
        <a href="/admin/board/manage" class="admin-link">게시판 관리</a>
      </div>

      <div class="vip-content" th:if="${isVip}">
        <div class="vip-badge">VIP 전용 콘텐츠</div>
        <p>VIP 회원님을 위한 특별한 게시글입니다.</p>
      </div>

      <!-- 권한에 따른 버튼 표시 -->
      <div class="action-buttons">
        <!-- 관리자는 모든 버튼 표시 -->
        <button th:if="${isAdmin}" class="admin-btn">관리자 기능</button>
        
        <!-- VIP 회원은 특별 기능 표시 -->
        <button th:if="${isVip}" class="vip-btn">VIP 기능</button>
        
        <!-- 일반 회원은 기본 기능만 표시 -->
        <button th:if="${!isAdmin and !isVip}" class="normal-btn">일반 기능</button>
      </div>

      <!-- 권한에 따른 메뉴 표시 -->
      <div class="user-menu">
        <div th:if="${isAdmin}" class="admin-menu">
          <a href="/admin/dashboard">관리자 대시보드</a>
          <a href="/admin/users">회원 관리</a>
        </div>
        
        <div th:if="${isVip}" class="vip-menu">
          <a href="/vip/benefits">VIP 혜택</a>
          <a href="/vip/support">VIP 고객지원</a>
        </div>
      </div>

      <!-- data 속성을 사용한 권한 체크 예시 -->
      <div class="data-attribute-examples">
        <!-- 관리자 전용 요소 -->
        <button data-require-admin class="admin-only-btn" onclick="adminFunction()">
          관리자 전용 기능
        </button>
        
        <!-- VIP 전용 요소 -->
        <div data-require-vip class="vip-only-content">
          <h3>VIP 전용 콘텐츠</h3>
          <p>VIP 회원님만 볼 수 있는 특별한 내용입니다.</p>
        </div>
        
        <!-- 로그인 필요 요소 -->
        <button data-require-login class="login-required-btn" onclick="loginRequiredFunction()">
          로그인 후 이용 가능
        </button>
      </div>

      <!-- JavaScript에서 권한 체크 사용 예시 -->
      <script>
      // 권한에 따른 조건부 실행
      function adminFunction() {
          executeIfAdmin(() => {
              console.log('관리자 기능 실행');
              // 관리자 전용 로직
          });
      }

      function vipFunction() {
          executeIfVip(() => {
              console.log('VIP 기능 실행');
              // VIP 전용 로직
          });
      }

      function loginRequiredFunction() {
          executeIfLoggedIn(() => {
              console.log('로그인 사용자 기능 실행');
              // 로그인 사용자 전용 로직
          });
      }

      // 현재 사용자 정보 확인
      function showUserInfo() {
          console.log('사용자 ID:', getCurrentUserId());
          console.log('이메일:', getCurrentUserEmail());
          console.log('닉네임:', getCurrentUserNickname());
          console.log('회원구분:', getCurrentUserGubun());
          console.log('관리자 여부:', isCurrentUserAdmin());
          console.log('VIP 여부:', isCurrentUserVip());
          console.log('로그인 여부:', isCurrentUserLoggedIn());
      }
      </script>
    </main>
  </th:block>
  <th:block th:fragment="footer">
    <footer class="foot" th:insert="~{fragment/footer::global}"/>
  </th:block>
</body>
</html> 