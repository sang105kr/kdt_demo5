<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:data-login-member="${session?.loginMember}"
      th:data-admin-id="${session?.loginMember?.memberId}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관리자 채팅 상담 - KDT Demo</title>
  <link rel="stylesheet" href="/css/admin/chat/session.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="chat-container">
        <div class="chat-header">
      <div class="drag-handle">
        <i class="fas fa-grip-vertical"></i>
      </div>
      <h2>관리자 채팅 상담</h2>
      <button class="end-chat-btn" id="endChatBtn" onclick="showExitModal()">
        <i class="fas fa-times"></i>
        상담 종료
      </button>
            </div>
    
    <div class="session-info" id="sessionInfo">
      <h3>상담 정보</h3>
      <div class="session-details">
        <div class="customer-info">
          <h4>고객 정보</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">이름:</span>
              <span class="info-value" id="customerName">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">이메일:</span>
              <span class="info-value" id="customerEmail">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">연락처:</span>
              <span class="info-value" id="customerPhone">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">가입일:</span>
              <span class="info-value" id="customerJoinDate">-</span>
            </div>
          </div>
        </div>
        <div class="session-info-details">
          <h4>상담 정보</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">카테고리:</span>
              <span class="info-value" id="categoryName">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">시작시간:</span>
              <span class="info-value" id="startTime">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">상담원:</span>
              <span class="info-value" id="adminName">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 보안 경고 메시지 -->
    <div id="securityWarning" class="security-warning" style="display: none;">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="securityWarningText">보안상의 이유로 일부 기능이 제한됩니다.</span>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="loading">
              <i class="fas fa-spinner fa-spin"></i>
        대기 중인 상담을 찾고 있습니다...
            </div>
          </div>
          
    <div class="chat-input">
            <div class="input-container">
        <textarea 
          class="message-input" 
          id="messageInput" 
                        placeholder="메시지를 입력하세요... (Enter: 전송, Shift+Enter: 줄바꿈)"
          maxlength="1000"
          rows="1"
        ></textarea>
        <button class="send-btn" id="sendBtn" disabled>
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- 공통 스크립트 -->
          <script src="/js/common.js"></script>
          
          <!-- WebSocket 라이브러리 -->
          <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
          
          <!-- 종료 사유 모달 -->
          <div id="exitModal" class="exit-modal-overlay" style="display: none;">
            <div class="exit-modal">
              <h3>상담 종료</h3>
              <p>상담을 종료하시겠습니까?<br>종료 사유를 선택해 주세요.</p>
              
              <div class="exit-reason-options">
                <div class="exit-reason-option">
                  <input type="radio" id="reason-solved" name="exitReason" value="144">
                  <label for="reason-solved">✅ 해결됨</label>
                </div>
                <div class="exit-reason-option">
                  <input type="radio" id="reason-unsatisfied" name="exitReason" value="145">
                  <label for="reason-unsatisfied">❌ 불만족</label>
                </div>
                <div class="exit-reason-option">
                  <input type="radio" id="reason-other-method" name="exitReason" value="146">
                  <label for="reason-other-method">🔄 다른 방법으로 문의</label>
                </div>
                <div class="exit-reason-option">
                  <input type="radio" id="reason-later" name="exitReason" value="147">
                  <label for="reason-later">⏰ 나중에 다시 문의</label>
                </div>
                <div class="exit-reason-option">
                  <input type="radio" id="reason-phone" name="exitReason" value="148">
                  <label for="reason-phone">📞 전화 상담 희망</label>
                </div>
                <div class="exit-reason-option">
                  <input type="radio" id="reason-just-exit" name="exitReason" value="149">
                  <label for="reason-just-exit">🚪 그냥 종료</label>
                </div>
              </div>
              
              <div class="exit-modal-buttons">
                <button class="exit-modal-btn cancel" onclick="cancelExit()">취소</button>
                <button class="exit-modal-btn confirm" onclick="confirmExit()">상담 종료</button>
              </div>
            </div>
          </div>

          <!-- 관리자 채팅 스크립트 -->
          <script src="/js/admin/chat/session.js"></script>
        </body>
        </html>
