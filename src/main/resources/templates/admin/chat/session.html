<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragment/layout::main(
      ~{::title},       
      ~{::link},
      ~{::script},
      ~{},
      ~{::top},         
      ~{::banner},      
      ~{::gnb},         
      ~{::main},        
      ~{::footer}       
      )}">
<head>
  <title th:fragment="title">채팅 상담 - KDT Demo</title>
  <link rel="stylesheet" href="/css/admin/chat/session.css">
  <script defer src="/js/admin/chat/session.js"></script>
  <!-- WebSocket 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style></style>
</head>
<body>
  <!-- 상단 메뉴 -->
  <th:block >
    <nav th:fragment="top" class="topmenu" th:insert="~{fragment/top::topmenu}"/>
  </th:block>

  <!-- 배너 -->
  <th:block th:fragment="banner">
    <header class="head" th:insert="~{fragment/banner::global}"/>
  </th:block>
  
  <!-- GNB -->
  <th:block th:fragment="gnb">
    <nav class="gnb" th:insert="~{fragment/menu::gnbmenu}"/>
  </th:block>
  
  <!-- 본문 -->
  <th:block th:fragment="main">
    <main class="main">
      <div class="admin-chat-session-container">
        <!-- 채팅 헤더 -->
        <div class="chat-header">
          <div class="header-left">
            <a href="/admin/chat/dashboard" class="back-btn">
              <i class="fas fa-arrow-left"></i>
              대시보드로
            </a>
            <div class="session-info">
              <h1 class="session-title" id="sessionTitle">상담 세션</h1>
              <div class="session-meta">
                <span class="customer-name" id="customerName">고객명</span>
                <span class="session-status" id="sessionStatus">대기 중</span>
                <span class="session-time" id="sessionTime">14:30</span>
              </div>
            </div>
          </div>
          <div class="header-right">
            <div class="session-actions">
              <button id="endSessionBtn" class="btn btn-danger">
                <i class="fas fa-times"></i>
                상담 종료
              </button>
            </div>
          </div>
        </div>

        <!-- 채팅 컨테이너 -->
        <div class="chat-container">
          <!-- 메시지 영역 -->
          <div class="chat-messages" id="messageArea">
            <div class="loading" id="loadingMessages">
              <i class="fas fa-spinner fa-spin"></i>
              메시지를 불러오는 중...
            </div>
            <!-- 메시지들이 여기에 동적으로 추가됨 -->
          </div>
          
          <!-- 입력 영역 -->
          <div class="chat-input-area">
            <div class="input-container">
              <textarea id="messageInput" 
                        placeholder="메시지를 입력하세요... (Enter: 전송, Shift+Enter: 줄바꿈)"
                        maxlength="1000"></textarea>
              <div class="input-actions">
                <span id="charCount">0/1000</span>
                <button id="sendBtn" class="btn btn-primary" disabled>
                  <i class="fas fa-paper-plane"></i>
                  전송
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 세션 정보 사이드바 -->
        <div class="session-sidebar">
          <div class="sidebar-header">
            <h3>세션 정보</h3>
          </div>
          
          <div class="sidebar-content">
            <div class="info-section">
              <h4>고객 정보</h4>
              <div class="info-item">
                <span class="label">이름:</span>
                <span class="value" id="sidebarCustomerName">-</span>
              </div>
              <div class="info-item">
                <span class="label">이메일:</span>
                <span class="value" id="sidebarCustomerEmail">-</span>
              </div>
              <div class="info-item">
                <span class="label">연락처:</span>
                <span class="value" id="sidebarCustomerPhone">-</span>
              </div>
            </div>
            
            <div class="info-section">
              <h4>상담 정보</h4>
              <div class="info-item">
                <span class="label">시작 시간:</span>
                <span class="value" id="sidebarStartTime">-</span>
              </div>
              <div class="info-item">
                <span class="label">메시지 수:</span>
                <span class="value" id="sidebarMessageCount">0</span>
              </div>
              <div class="info-item">
                <span class="label">상담원:</span>
                <span class="value" id="sidebarAdminName">-</span>
              </div>
            </div>
            
            <div class="info-section">
              <h4>빠른 응답</h4>
              <div class="quick-replies">
                <button class="quick-reply-btn" onclick="sendQuickReply('안녕하세요! 무엇을 도와드릴까요?')">
                  안녕하세요! 무엇을 도와드릴까요?
                </button>
                <button class="quick-reply-btn" onclick="sendQuickReply('잠시만 기다려주세요. 확인 후 답변드리겠습니다.')">
                  잠시만 기다려주세요. 확인 후 답변드리겠습니다.
                </button>
                <button class="quick-reply-btn" onclick="sendQuickReply('추가 문의사항이 있으시면 언제든 말씀해주세요.')">
                  추가 문의사항이 있으시면 언제든 말씀해주세요.
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </th:block>
  
  <!-- 푸터 -->
  <th:block th:fragment="footer">
    <footer class="foot" th:insert="~{fragment/footer::global}"/>
  </th:block>
</body>
</html>
