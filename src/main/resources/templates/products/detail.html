<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragment/layout::main(
      ~{::title},       
      ~{::link},
      ~{::script},
      ~{},
      ~{::top},         
      ~{::banner},      
      ~{::gnb},         
      ~{::main},        
      ~{::footer}       
      )}">
<head>
  <title th:fragment="title">ÏÉÅÌíà ÏÉÅÏÑ∏</title>
  <link rel="stylesheet" href="/css/products/detail.css">
  <script defer src="/js/products/detail.js"></script>
  <script>
    // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑ Î™®Îã¨ Ï°¥Ïû¨ ÌôïÏù∏
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded Ïù¥Î≤§Ìä∏ Î∞úÏÉù');
      const modal = document.getElementById('reviewModal');
      console.log('DOMContentLoadedÏóêÏÑú Î™®Îã¨ Í≤ÄÏÉâ:', modal);
      if (modal) {
        console.log('Î™®Îã¨Ïù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Î°úÎìúÎêòÏóàÏäµÎãàÎã§.');
      } else {
        console.error('DOMContentLoaded ÌõÑÏóêÎèÑ Î™®Îã¨ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
      }
    });
    
    // ÌéòÏù¥ÏßÄ ÏôÑÏ†Ñ Î°úÎìú ÌõÑÏóêÎèÑ ÌôïÏù∏
    window.addEventListener('load', function() {
      console.log('window load Ïù¥Î≤§Ìä∏ Î∞úÏÉù');
      const modal = document.getElementById('reviewModal');
      console.log('window loadÏóêÏÑú Î™®Îã¨ Í≤ÄÏÉâ:', modal);
    });
  </script>
  <style></style>
</head>
<body>
  <!-- ÏÉÅÎã® Î©îÎâ¥ -->
  <th:block >
    <nav th:fragment="top" class="topmenu" th:insert="~{fragment/top::topmenu}"/>
  </th:block>

  <!-- Î∞∞ÎÑà -->
  <th:block th:fragment="banner">
    <header class="head" th:insert="~{fragment/banner::global}"/>
  </th:block>
  
  <!-- GNB -->
  <th:block th:fragment="gnb">
    <nav class="gnb" th:insert="~{fragment/menu::gnbmenu}"/>
  </th:block>
  
  <!-- Î≥∏Î¨∏ -->
  <th:block th:fragment="main">
    <main class="main">
        <div class="product-detail-container" 
             th:data-product-id="${product.productId}"
             th:data-is-purchased="${isPurchased}">
            <!-- ÏÉÅÌíà Ï†ïÎ≥¥ ÏÑπÏÖò -->
            <section class="product-detail-section">
                <div class="product-detail-grid">
                    <!-- ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ ÏÑπÏÖò -->
                    <div class="product-image-section">
                        <!-- ÎåÄÌëúÏù¥ÎØ∏ÏßÄ ÏòÅÏó≠ (Í≥†Ï†ï ÌÅ¨Í∏∞) -->
                        <div class="main-image-container">
                            <div class="main-image" onclick="showImageModal(this.querySelector('img').src, this.querySelector('img').alt)">
                                <img th:if="${product.imageUrls != null and !product.imageUrls.isEmpty()}" 
                                     th:src="@{${product.imageUrls[0]}}" 
                                     th:alt="${product.pname}"
                                     class="product-main-img"
                                     id="mainImage">
                                <div th:unless="${product.imageUrls != null and !product.imageUrls.isEmpty()}" 
                                     class="product-img-placeholder">
                                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                    <span>Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</span>
                                </div>
                                <!-- ÌôïÎåÄ ÏïÑÏù¥ÏΩò -->
                                <div class="zoom-icon" th:if="${product.imageUrls != null and !product.imageUrls.isEmpty()}">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                        <line x1="11" y1="8" x2="11" y2="14"></line>
                                        <line x1="8" y1="11" x2="14" y2="11"></line>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ïç∏ÎÑ§Ïùº ÏòÅÏó≠ (Ïó¨Îü¨ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎäî Í≤ΩÏö∞) -->
                        <div class="thumbnail-section" th:if="${product.imageUrls != null and product.imageUrls.size() > 1}">
                            <div class="gallery-thumbnails">
                                <div th:each="imageUrl, iterStat : ${product.imageUrls}" 
                                     th:class="${iterStat.first ? 'thumbnail active' : 'thumbnail'}"
                                     th:data-image-url="${imageUrl}"
                                     onclick="changeMainImage(this.dataset.imageUrl, this)">
                                    <img th:src="@{${imageUrl}}" th:alt="${product.pname}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÏÉÅÌíà Ï†ïÎ≥¥ ÏÑπÏÖò -->
                    <div class="product-info-section">
                        <div class="product-header">
                            <h1 class="product-name" th:utext="${product.displayPname}">ÏÉÅÌíàÎ™Ö</h1>
                            <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉúÍ∑∏ -->
                            <div class="product-category">
                                <span class="category-tag" th:text="${product.categoryName != null ? product.categoryName : (categoryName != null ? categoryName : product.category)}">Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                            </div>
                        </div>

                        <!-- ÌèâÏ†ê Î∞è Î¶¨Î∑∞ Ï†ïÎ≥¥ -->
                        <div class="product-rating-section" th:if="${product.rating != null}">
                            <div class="rating-display">
                                <div class="stars">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                          th:class="${i <= product.rating ? 'star filled' : (i - 0.5 <= product.rating ? 'star half' : 'star')}">
                                        ‚òÖ
                                    </span>
                                </div>
                                <span class="rating-text" th:text="${product.rating} + 'Ï†ê'">0.0Ï†ê</span>
                                <span class="review-count" th:if="${product.reviewCount != null}" 
                                      th:text="'(' + ${product.reviewCount} + 'Í∞úÏùò Î¶¨Î∑∞)'">(0Í∞úÏùò Î¶¨Î∑∞)</span>
                            </div>
                        </div>

                        <!-- Í∞ÄÍ≤© Ï†ïÎ≥¥ -->
                        <div class="product-price-section">
                            <div class="price-display">
                                <span class="price-amount" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + 'Ïõê'">0Ïõê</span>
                                <span class="price-label">ÌåêÎß§Í∞Ä</span>
                            </div>
                        </div>

                        <!-- Ïû¨Í≥† Ï†ïÎ≥¥ -->
                        <div class="product-stock-section">
                            <div class="stock-info">
                                <span class="stock-label">Ïû¨Í≥†:</span>
                                <span class="stock-amount" th:text="${product.stockQuantity} + 'Í∞ú'">0Í∞ú</span>
                                <span th:if="${product.stockQuantity <= 0}" class="out-of-stock-badge">ÌíàÏ†à</span>
                                <span th:if="${product.stockQuantity <= 5 and product.stockQuantity > 0}" class="low-stock-badge">ÌíàÏ†àÏûÑÎ∞ï</span>
                            </div>
                        </div>

                        <!-- Íµ¨Îß§ ÏòµÏÖò -->
                        <div class="purchase-options-section" th:if="${product.stockQuantity > 0}">
                            <div class="quantity-selector">
                                <label for="quantity">ÏàòÎüâ:</label>
                                <div class="quantity-controls">
                                    <button type="button" class="quantity-btn minus-btn" onclick="decreaseQuantity()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                    <input type="number" id="quantity" value="1" min="1" 
                                           th:max="${product.stockQuantity}" class="quantity-input">
                                    <button type="button" class="quantity-btn plus-btn" onclick="increaseQuantity()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="purchase-actions">
                                <button class="btn btn--primary add-to-cart-btn"
                                        th:data-product-id="${product.productId}"
                                        onclick="addToCart(this.dataset.productId)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3z"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3z"></path>
                                    </svg>
                                    Ïû•Î∞îÍµ¨Îãà Îã¥Í∏∞
                                </button>
                                <button class="btn btn--light buy-now-btn"
                                        th:data-product-id="${product.productId}"
                                        onclick="buyNow(this.dataset.productId)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22,4 12,14.01 9,11.01"></polyline>
                                    </svg>
                                    Î∞îÎ°ú Íµ¨Îß§
                                </button>
                                <button class="btn btn-wishlist wishlist-btn" 
                                        type="button"
                                        th:data-product-id="${product.productId}"
                                        onclick="toggleWishlist(this.dataset.productId, this)">
                                    <svg class="heart-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>
                                    <span class="wishlist-text">ÏúÑÏãúÎ¶¨Ïä§Ìä∏</span>
                                </button>
                                <button class="btn btn--light share-btn" type="button" onclick="shareProduct()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="18" cy="5" r="3"></circle>
                                        <circle cx="6" cy="12" r="3"></circle>
                                        <circle cx="18" cy="19" r="3"></circle>
                                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                    </svg>
                                    Í≥µÏú†ÌïòÍ∏∞
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÌíàÏ†à ÏÉÅÌÉú -->
                        <div class="out-of-stock-section" th:if="${product.stockQuantity <= 0}">
                            <div class="out-of-stock-message">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="15" y1="9" x2="9" y2="15"></line>
                                    <line x1="9" y1="9" x2="15" y2="15"></line>
                                </svg>
                                <h3>ÌíàÏ†à</h3>
                                <p>ÌòÑÏû¨ Ïû¨Í≥†Í∞Ä ÏóÜÏäµÎãàÎã§. ÎÇòÏ§ëÏóê Îã§Ïãú ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</p>
                                <button class="btn btn--light" onclick="location.reload()">ÏÉàÎ°úÍ≥†Ïπ®</button>
                            </div>
                        </div>

                        <!-- Îß§Îâ¥Ïñº Îã§Ïö¥Î°úÎìú -->
                        <div th:if="${product.manualUrls != null and !product.manualUrls.isEmpty()}" class="product-manual-section">
                            <h3 class="manual-title">Ï†úÌíà Îß§Îâ¥Ïñº</h3>
                            <div class="manual-downloads">
                                <a th:each="manualUrl, iterStat : ${product.manualUrls}" 
                                   th:href="@{${manualUrl}}" 
                                   class="manual-download-btn"
                                   download>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7,10 12,15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Îß§Îâ¥Ïñº Îã§Ïö¥Î°úÎìú <span th:text="${iterStat.count}">1</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ÏÉÅÌíà ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌÉ≠ -->
            <section class="product-tabs-section">
                <div class="product-tabs">
                    <button class="tab-btn active" data-tab="description">ÏÉÅÌíà ÏÑ§Î™Ö</button>
                    <button class="tab-btn" data-tab="specifications">ÏÉÅÌíà Ïä§Ìéô</button>
                    <button class="tab-btn" data-tab="reviews">Î¶¨Î∑∞</button>

                </div>
                
                <div class="tab-content">
                    <!-- ÏÉÅÌíà ÏÑ§Î™Ö ÌÉ≠ -->
                    <div class="tab-pane active" id="description">
                        <div class="product-description">
                            <h3>ÏÉÅÌíà ÏÑ§Î™Ö</h3>
                            <div class="description-content" th:utext="${product.displayDescription}">ÏÉÅÌíà ÏÑ§Î™Ö</div>
                        </div>
                    </div>
                    
                    <!-- ÏÉÅÌíà Ïä§Ìéô ÌÉ≠ -->
                    <div class="tab-pane" id="specifications">
                        <div class="product-specifications">
                            <h3>ÏÉÅÌíà Ïä§Ìéô</h3>
                            
                            <!-- Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                            <div class="spec-section">
                                <h4>Í∏∞Î≥∏ Ï†ïÎ≥¥</h4>
                                <div class="specs-table">
                                    <div class="spec-row">
                                        <span class="spec-label">ÏÉÅÌíàÎ™Ö</span>
                                        <span class="spec-value" th:utext="${product.displayPname}">ÏÉÅÌíàÎ™Ö</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                                        <span class="spec-value" th:text="${categoryName != null ? categoryName : product.category}">Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Í∞ÄÍ≤©</span>
                                        <span class="spec-value" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')} + 'Ïõê'">Í∞ÄÍ≤©</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">ÌèâÏ†ê</span>
                                        <span class="spec-value" th:text="${product.rating != null ? product.rating + 'Ï†ê' : 'ÌèâÏ†ê ÏóÜÏùå'}">ÌèâÏ†ê</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Îì±Î°ùÏùº</span>
                                        <span class="spec-value" th:text="${#temporals.format(product.cdate, 'yyyy-MM-dd')}">Îì±Î°ùÏùº</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÏÉÅÌíà ÏÉÅÏÑ∏ Ïä§Ìéô -->
                            <div class="spec-section" th:if="${product.specifications != null and !product.specifications.isEmpty()}">
                                <h4>ÏÉÅÌíà ÏÉÅÏÑ∏ Ïä§Ìéô</h4>
                                <div class="specs-table">
                                    <div th:each="spec : ${product.specifications}" class="spec-row">
                                        <span class="spec-label" th:text="${spec.key}">Ïä§ÌéôÎ™Ö</span>
                                        <span class="spec-value" th:text="${spec.value}">Ïä§ÌéôÍ∞í</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Î∞∞ÏÜ° Ï†ïÎ≥¥ -->
                            <div class="spec-section">
                                <h4>Î∞∞ÏÜ° Ï†ïÎ≥¥</h4>
                                <div class="specs-table">
                                    <div class="spec-row">
                                        <span class="spec-label">Î∞∞ÏÜ° Î∞©Î≤ï</span>
                                        <span class="spec-value">ÌÉùÎ∞∞</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Î∞∞ÏÜ° ÏßÄÏó≠</span>
                                        <span class="spec-value">Ï†ÑÍµ≠</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Î∞∞ÏÜ°ÎπÑ</span>
                                        <span class="spec-value">Î¨¥Î£åÎ∞∞ÏÜ°</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Î∞∞ÏÜ° Í∏∞Í∞Ñ</span>
                                        <span class="spec-value">1-3Ïùº</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- A/S Ï†ïÎ≥¥ -->
                            <div class="spec-section">
                                <h4>A/S Ï†ïÎ≥¥</h4>
                                <div class="specs-table">
                                    <div class="spec-row">
                                        <span class="spec-label">Î≥¥Ï¶ù Í∏∞Í∞Ñ</span>
                                        <span class="spec-value">1ÎÖÑ</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">A/S Ïó∞ÎùΩÏ≤ò</span>
                                        <span class="spec-value">1588-0000</span>
                                    </div>
                                    <div class="spec-row">
                                        <span class="spec-label">Î∞òÌíà/ÍµêÌôò</span>
                                        <span class="spec-value">7Ïùº Ïù¥ÎÇ¥</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Î¶¨Î∑∞ ÌÉ≠ -->
                    <div class="tab-pane" id="reviews">
                        <div class="product-reviews">
                            <div class="reviews-header">
                                <div class="reviews-title-section">
                                    <h3>ÏÉÅÌíà Î¶¨Î∑∞</h3>
                                    <div class="reviews-summary" th:if="${product.rating != null}">
                                        <div class="rating-display">
                                            <div class="stars">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= product.rating ? 'star filled' : (i - 0.5 <= product.rating ? 'star half' : 'star')}">
                                                    ‚òÖ
                                                </span>
                                            </div>
                                            <span class="rating-text" th:text="${product.rating} + 'Ï†ê'">0.0Ï†ê</span>
                                            <span class="review-count" th:if="${product.reviewCount != null}" 
                                                  th:text="'(' + ${product.reviewCount} + 'Í∞úÏùò Î¶¨Î∑∞)'">(0Í∞úÏùò Î¶¨Î∑∞)</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Î¶¨Î∑∞ ÏûëÏÑ± Î≤ÑÌäº -->
                                <div class="reviews-actions">
                                    <!-- Íµ¨Îß§Ìïú ÏÇ¨Ïö©ÏûêÏù¥ÏßÄÎßå ÏïÑÏßÅ Î¶¨Î∑∞Î•º ÏûëÏÑ±ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ÏóêÎßå ÌëúÏãú -->
                                    <div th:if="${isPurchased and !hasReviewed}" class="purchased-user-actions">
                                        <div class="review-prompt-card">
                                            <div class="prompt-icon">‚≠ê</div>
                                            <div class="prompt-content">
                                                <h4>Ïù¥ ÏÉÅÌíàÏùÑ Íµ¨Îß§ÌïòÏÖ®Íµ∞Ïöî!</h4>
                                                <p>Íµ¨Îß§ ÌõÑ ÏÜîÏßÅÌïú Î¶¨Î∑∞Î•º ÏûëÏÑ±Ìï¥Ï£ºÏãúÎ©¥ Îã§Î•∏ Í≥†Í∞ùÏóêÍ≤å ÎèÑÏõÄÏù¥ Îê©ÎãàÎã§.</p>
                                                <a th:href="@{/member/mypage/orders}" class="btn btn--primary">Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏóêÏÑú Î¶¨Î∑∞ ÏûëÏÑ±</a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Íµ¨Îß§ÌïòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÌëúÏãú -->
                                    <div th:unless="${isPurchased}" class="non-purchased-user-actions">
                                        <div class="review-prompt-card">
                                            <div class="prompt-icon">üí¨</div>
                                            <div class="prompt-content">
                                                <h4>Ïù¥ ÏÉÅÌíàÏùÑ Íµ¨Îß§Ìï¥Î≥¥ÏÑ∏Ïöî</h4>
                                                <p>Íµ¨Îß§ ÌõÑ ÏÜîÏßÅÌïú Î¶¨Î∑∞Î•º ÏûëÏÑ±Ìï¥Ï£ºÏãúÎ©¥ Îã§Î•∏ Í≥†Í∞ùÏóêÍ≤å ÎèÑÏõÄÏù¥ Îê©ÎãàÎã§.</p>
                                                <a href="#purchase-options" class="btn btn--outline">Íµ¨Îß§ÌïòÍ∏∞</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Î¶¨Î∑∞ ÌïÑÌÑ∞ -->
                            <div class="reviews-filter" th:if="${reviews != null and !reviews.isEmpty()}">
                                <div class="filter-options">
                                    <button type="button" class="filter-btn active" data-filter="all" onclick="filterReviews('all')">Ï†ÑÏ≤¥</button>
                                    <button type="button" class="filter-btn" data-filter="5" onclick="filterReviews('5')">5Ï†ê</button>
                                    <button type="button" class="filter-btn" data-filter="4" onclick="filterReviews('4')">4Ï†ê</button>
                                    <button type="button" class="filter-btn" data-filter="3" onclick="filterReviews('3')">3Ï†ê</button>
                                    <button type="button" class="filter-btn" data-filter="2" onclick="filterReviews('2')">2Ï†ê</button>
                                    <button type="button" class="filter-btn" data-filter="1" onclick="filterReviews('1')">1Ï†ê</button>
                                </div>
                                <div class="sort-options">
                                    <select class="sort-select" onchange="sortReviews(this.value)">
                                        <option value="latest">ÏµúÏã†Ïàú</option>
                                        <option value="rating">ÌèâÏ†êÏàú</option>
                                        <option value="helpful">ÎèÑÏõÄÏàú</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Î¶¨Î∑∞ Î™©Î°ù -->
                            <div class="reviews-list" th:if="${reviews != null and !reviews.isEmpty()}">
                                <div class="review-items">
                                    <div th:each="review : ${reviews}" class="review-item" th:data-rating="${review.review.rating}">
                                        <div class="review-header">
                                            <!-- ÏûëÏÑ±Ïûê Ï†ïÎ≥¥ -->
                                            <div class="review-author">
                                                <div class="author-avatar">
                                                    <img th:if="${review.member != null and review.member.pic != null and review.member.pic.length > 0}" 
                                                         th:src="@{/member/mypage/profile-image/view/{memberId}(memberId=${review.member.memberId})}" 
                                                         th:alt="${review.member.nickname}"
                                                         class="author-profile-img">
                                                    <div th:unless="${review.member != null and review.member.pic != null and review.member.pic.length > 0}" 
                                                         class="author-profile-placeholder">
                                                        <span th:text="${review.member != null ? review.member.nickname.substring(0, 1) : '?'}">?</span>
                                                    </div>
                                                </div>
                                                <div class="author-info">
                                                    <span class="author-nickname" th:text="${review.member != null ? review.member.nickname : 'Ïïå Ïàò ÏóÜÏùå'}">ÎãâÎÑ§ÏûÑ</span>
                                                    <span class="review-date" th:text="${#temporals.format(review.review.cdate, 'yyyy-MM-dd')}">ÏûëÏÑ±Ïùº</span>
                                                </div>
                                            </div>
                                            <div class="review-rating">
                                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                                      th:class="${i <= review.review.rating ? 'star filled' : 'star'}">‚òÖ</span>
                                            </div>
                                        </div>
                                        <div class="review-content">
                                            <h4 class="review-title" th:text="${review.review.title}">Î¶¨Î∑∞ Ï†úÎ™©</h4>
                                            <p class="review-text" th:text="${review.review.content}">Î¶¨Î∑∞ ÎÇ¥Ïö©</p>
                                        </div>
                                        <div class="review-actions">
                                            <!-- ÎåìÍ∏Ä Î≤ÑÌäº (ÏôºÏ™Ω) -->
                                            <button type="button" class="comment-btn" th:onclick="'toggleCommentForm(' + ${review.review.reviewId} + ')'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                                </svg>
                                                ÎåìÍ∏Ä <span class="comment-count" th:text="${review.commentCount != null ? review.commentCount : 0}">0</span>
                                            </button>
                                            
                                            <!-- Ïò§Î•∏Ï™Ω Î≤ÑÌäº Í∑∏Î£π -->
                                            <div class="right-actions">
                                            <button type="button" class="helpful-btn" th:onclick="'markHelpful(' + ${review.review.reviewId} + ')'">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M14 9V5a3 3 0 0 0-6 0v4"></path>
                                                    <rect x="2" y="9" width="20" height="10" rx="2" ry="2"></rect>
                                                </svg>
                                                ÎèÑÏõÄÎê® <span class="helpful-count" th:text="${review.review.helpfulCount != null ? review.review.helpfulCount : 0}">0</span>
                                            </button>
                                                
                                                <!-- Ïã†Í≥† Î≤ÑÌäº -->
                                                <button type="button" class="report-btn" th:onclick="'reportReview(' + ${review.review.reviewId} + ')'">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                                        <line x1="12" y1="9" x2="12" y2="13"></line>
                                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                                    </svg>
                                                    Ïã†Í≥† <span class="report-count" th:text="${review.review.reportCount != null ? review.review.reportCount : 0}">0</span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- ÎåìÍ∏Ä ÏÑπÏÖò -->
                                        <div class="review-comments" th:id="'comments-' + ${review.review.reviewId}" style="display: none;">
                                            <!-- ÎåìÍ∏Ä Î™©Î°ù -->
                                            <div class="comment-list" th:id="'comment-list-' + ${review.review.reviewId}">
                                                <!-- ÎåìÍ∏ÄÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Î°úÎìúÎê©ÎãàÎã§ -->
                                            </div>
                                            
                                            <!-- ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Îäî layout.htmlÏùò data-s-member-idÏóêÏÑú Í∞ÄÏ†∏ÏòµÎãàÎã§ -->
                                            
                                            <!-- ÎåìÍ∏Ä ÏûëÏÑ± Ìèº (Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÎßå) -->
                                            <div th:if="${session.loginMember != null}" class="comment-write-form">
                                                <form class="comment-form" th:data-review-id="${review.review.reviewId}">
                                                    <div class="comment-input-wrapper">
                                                        <div class="comment-input-container">
                                                            <textarea name="content" 
                                                                     placeholder="Î¶¨Î∑∞Ïóê ÎåÄÌïú ÏùòÍ≤¨ÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî (ÏµúÎåÄ 500Ïûê)" 
                                                                     rows="1" maxlength="500" required></textarea>
                                                            <div class="comment-form-actions">
                                                                <div class="char-count">
                                                                    <span class="comment-char-count">0</span>/500
                                                                </div>
                                                                <button type="button" class="comment-submit-btn" onclick="submitComment(this)">
                                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                        <path d="M22 2L11 13"></path>
                                                                        <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                                                                    </svg>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            
                                            <!-- Î°úÍ∑∏Ïù∏ÌïòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©Ïûê -->
                                            <div th:if="${session.loginMember == null}" class="login-required">
                                                <p>ÎåìÍ∏ÄÏùÑ ÏûëÏÑ±ÌïòÎ†§Î©¥ <a th:href="@{/login}">Î°úÍ∑∏Ïù∏</a>Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Î¶¨Î∑∞ ÌéòÏù¥Ïßï -->
                                <div class="reviews-pagination" th:if="${reviewPagination != null and reviewPagination.totalPages > 1}">
                                    <div class="pagination">
                                        <!-- Ïù¥Ï†Ñ Î∏îÎ°ù -->
                                        <a th:if="${reviewPagination.hasPrevBlock}" 
                                           th:href="@{/products/{productId}(productId=${product.productId}, reviewPage=${reviewPagination.startPage - 1})}"
                                           class="page-link prev-block">
                                            &laquo;
                                        </a>
                                        
                                        <!-- ÌéòÏù¥ÏßÄ Î≤àÌò∏Îì§ -->
                                        <a th:each="pageNum : ${#numbers.sequence(reviewPagination.startPage, reviewPagination.endPage)}"
                                           th:href="@{/products/{productId}(productId=${product.productId}, reviewPage=${pageNum})}"
                                           th:class="${pageNum == reviewPagination.pageNo ? 'page-link active' : 'page-link'}">
                                            <span th:text="${pageNum}">1</span>
                                        </a>
                                        
                                        <!-- Îã§Ïùå Î∏îÎ°ù -->
                                        <a th:if="${reviewPagination.hasNextBlock}" 
                                           th:href="@{/products/{productId}(productId=${product.productId}, reviewPage=${reviewPagination.endPage + 1})}"
                                           class="page-link next-block">
                                            &raquo;
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Î¶¨Î∑∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ -->
                            <div th:if="${reviews == null or reviews.isEmpty()}" class="reviews-placeholder">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <p>ÏïÑÏßÅ Î¶¨Î∑∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                                <!-- Íµ¨Îß§Ìïú ÏÇ¨Ïö©ÏûêÏù¥ÏßÄÎßå ÏïÑÏßÅ Î¶¨Î∑∞Î•º ÏûëÏÑ±ÌïòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ÏóêÎßå ÌëúÏãú -->
                                <div th:if="${isPurchased and !hasReviewed}" class="purchased-user-prompt">
                                <p>Ï≤´ Î≤àÏß∏ Î¶¨Î∑∞Î•º ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
                                    <a th:href="@{/member/mypage/orders}" class="btn btn--primary">Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏóêÏÑú Î¶¨Î∑∞ ÏûëÏÑ±</a>
                                </div>
                                <!-- Íµ¨Îß§ÌïòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÌëúÏãú -->
                                <div th:unless="${isPurchased}" class="non-purchased-user-prompt">
                                    <p>Ïù¥ ÏÉÅÌíàÏùÑ Íµ¨Îß§ÌïòÍ≥† Ï≤´ Î≤àÏß∏ Î¶¨Î∑∞Î•º ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
                                    <a href="#purchase-options" class="btn btn--outline">Íµ¨Îß§ÌïòÍ∏∞</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                </div>
            </section>

            <!-- Í¥ÄÎ†® ÏÉÅÌíà ÏÑπÏÖò -->
            <section class="related-products-section" th:if="${relatedProducts != null and !relatedProducts.isEmpty()}">
                <div class="section-header">
                    <h2>Í∞ôÏùÄ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÉÅÌíà</h2>
                    <div class="section-links">
                        <a th:href="@{/products/category/{categoryId}(categoryId=${categoryCodeId})}" 
                           th:if="${categoryCodeId != null}"
                           class="view-all-link">
                            Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÑÏ≤¥Î≥¥Í∏∞
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9,18 15,12 9,6"></polyline>
                            </svg>
                        </a>
                        <span th:unless="${categoryCodeId != null}" class="view-all-link disabled">
                            Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÑÏ≤¥Î≥¥Í∏∞
                        </span>
                    </div>
                </div>
                
                <div class="related-products-grid">
                    <div th:each="relatedProduct : ${relatedProducts}" class="related-product-card">
                        <div class="related-product-image">
                            <a th:href="@{/products/{id}(id=${relatedProduct.productId})}">
                                <img th:if="${relatedProduct.imageUrl}" 
                                     th:src="@{${relatedProduct.imageUrl}}" 
                                     th:alt="${relatedProduct.pname}"
                                     class="related-product-img">
                                <div th:unless="${relatedProduct.imageUrl}" class="related-product-img-placeholder">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21,15 16,10 5,21"></polyline>
                                    </svg>
                                </div>
                            </a>
                        </div>
                        
                        <div class="related-product-info">
                            <h4 class="related-product-name">
                                <a th:href="@{/products/{id}(id=${relatedProduct.productId})}" 
                                   th:text="${relatedProduct.pname}">ÏÉÅÌíàÎ™Ö</a>
                            </h4>
                            <div class="related-product-price">
                                <span th:text="${#numbers.formatInteger(relatedProduct.price, 3, 'COMMA')} + 'Ïõê'">0Ïõê</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ÏóêÎü¨ Î©îÏãúÏßÄ -->
            <div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}"></div>
        </div>
    </main>
  </th:block>
  
  <!-- Ïù¥ÎØ∏ÏßÄ Î™®Îã¨ ÌåùÏóÖ -->
  <div id="imageModal" class="image-modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeImageModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </span>
      <img id="modalImage" class="modal-image" src="" alt="">
    </div>
  </div>
  

  
  <!-- Ìë∏ÌÑ∞ -->
  <th:block th:fragment="footer">
    <footer class="foot" th:insert="~{fragment/footer::global}"/>
  </th:block>
</body>
</html> 